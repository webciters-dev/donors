# DNS Configuration Guide for aircrew.nl Email Server
# Configure these records in your domain registrar's DNS panel

## Essential DNS Records (Required)

### Mail Exchange Record
```
Type: MX
Name: @  (or aircrew.nl)
Value: mail.aircrew.nl
Priority: 10
TTL: 3600
```

### Mail Server Hostname
```
Type: A
Name: mail
Value: 136.144.175.93
TTL: 3600
```

## Professional Email Subdomains (Recommended)

```
Type: A
Name: smtp
Value: 136.144.175.93
TTL: 3600

Type: A  
Name: imap
Value: 136.144.175.93
TTL: 3600

Type: A
Name: pop
Value: 136.144.175.93  
TTL: 3600

Type: A
Name: pop3
Value: 136.144.175.93
TTL: 3600
```

## Email Authentication Records (Critical for Deliverability)

### SPF Record
```
Type: TXT
Name: @
Value: v=spf1 mx a ip4:136.144.175.93 include:_spf.aircrew.nl ~all
TTL: 3600
```

### DKIM Record (Generated by setup script)
```
Type: TXT
Name: default._domainkey
Value: [Generated by email-server-setup.sh - see output]
TTL: 3600
```

### DMARC Policy
```
Type: TXT
Name: _dmarc
Value: v=DMARC1; p=quarantine; rua=mailto:dmarc@aircrew.nl; ruf=mailto:dmarc@aircrew.nl; fo=1
TTL: 3600
```

## Reverse DNS (PTR Record)
**Contact your VPS provider (likely DigitalOcean/Vultr/Linode) to set:**
```
PTR: 136.144.175.93 â†’ mail.aircrew.nl
```

## Autodiscover (Optional - for email client auto-configuration)
```
Type: A
Name: autodiscover
Value: 136.144.175.93
TTL: 3600
```

## Email Client Settings (After Setup)

### SMTP (Outgoing Mail)
- **Server:** mail.aircrew.nl
- **Port:** 587 (STARTTLS) or 465 (SSL/TLS)
- **Security:** STARTTLS or SSL/TLS
- **Authentication:** Username/Password

### IMAP (Incoming Mail - Recommended)
- **Server:** mail.aircrew.nl  
- **Port:** 993 (SSL/TLS) or 143 (STARTTLS)
- **Security:** SSL/TLS or STARTTLS

### POP3 (Incoming Mail - Alternative)
- **Server:** mail.aircrew.nl
- **Port:** 995 (SSL/TLS) or 110 (STARTTLS)  
- **Security:** SSL/TLS or STARTTLS

## Verification Steps

1. **DNS Propagation Check:**
   ```bash
   dig MX aircrew.nl
   dig A mail.aircrew.nl
   dig TXT aircrew.nl
   ```

2. **Email Server Test:**
   ```bash
   telnet mail.aircrew.nl 587
   openssl s_client -connect mail.aircrew.nl:465
   ```

3. **Mail Flow Test:**
   - Send test email from external provider
   - Check spam score at mail-tester.com
   - Verify DKIM signature

## Security Considerations

1. **Firewall Ports:** 25, 110, 143, 465, 587, 993, 995
2. **SSL/TLS:** Let's Encrypt certificates auto-renewal
3. **Rate Limiting:** Built into server configuration
4. **Fail2ban:** Automatic IP blocking for brute force
5. **DKIM Signing:** All outgoing emails signed
6. **SPF/DMARC:** Prevents email spoofing

## Troubleshooting

### Common Issues:
- **DNS propagation:** Wait 24-48 hours for global propagation
- **PTR record:** Contact VPS provider if emails marked as spam
- **Port blocking:** Some ISPs block port 25 outbound
- **SSL certificates:** Ensure Let's Encrypt renewal is working

### Log Files:
- Postfix: `/var/log/postfix.log`
- Dovecot: `/var/log/dovecot.log`
- System: `/var/log/mail.log`

### Test Commands:
```bash
# Check service status
systemctl status postfix dovecot opendkim

# Test SMTP authentication
swaks --to test@example.com --from noreply@aircrew.nl --auth-user noreply@aircrew.nl --auth-password NoreplySecure2024! --server mail.aircrew.nl:587 --tls

# Check DKIM setup
opendkim-testkey -d aircrew.nl -s default -vvv
```